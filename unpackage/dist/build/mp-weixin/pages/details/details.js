(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/details/details"],{"2f5e":function(o,t,e){"use strict";var n={uniIcons:function(){return Promise.all([e.e("common/vendor"),e.e("components/uni-icons/uni-icons")]).then(e.bind(null,"36fd"))},uniGoodsNav:function(){return e.e("components/uni-goods-nav/uni-goods-nav").then(e.bind(null,"feb8"))},uniPopup:function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"3e36"))},uniNumberBox:function(){return e.e("components/uni-number-box/uni-number-box").then(e.bind(null,"99a4"))}},i=function(){var o=this,t=o.$createElement;o._self._c},s=[];e.d(t,"b",(function(){return i})),e.d(t,"c",(function(){return s})),e.d(t,"a",(function(){return n}))},"7b8c":function(o,t,e){},aa11:function(o,t,e){"use strict";(function(o){e("9fd1");n(e("66fd"));var t=n(e("f9b6"));function n(o){return o&&o.__esModule?o:{default:o}}o(t.default)}).call(this,e("543d")["createPage"])},aecd:function(o,t,e){"use strict";e.r(t);var n=e("f9ab"),i=e.n(n);for(var s in n)"default"!==s&&function(o){e.d(t,o,(function(){return n[o]}))}(s);t["default"]=i.a},ef66:function(o,t,e){"use strict";var n=e("7b8c"),i=e.n(n);i.a},f9ab:function(o,t,e){"use strict";(function(o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(e("2ef0"));function i(o){return o&&o.__esModule?o:{default:o}}function s(o,t){var e=Object.keys(o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(o);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),e.push.apply(e,n)}return e}function u(o){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?s(Object(e),!0).forEach((function(t){c(o,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(e)):s(Object(e)).forEach((function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(e,t))}))}return o}function c(o,t,e){return t in o?Object.defineProperty(o,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):o[t]=e,o}var r=function(){e.e("components/uni-goods-nav/uni-goods-nav").then(function(){return resolve(e("feb8"))}.bind(null,e)).catch(e.oe)},a=function(){e.e("components/uni-popup/uni-popup").then(function(){return resolve(e("3e36"))}.bind(null,e)).catch(e.oe)},l=function(){e.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(e("1db5"))}.bind(null,e)).catch(e.oe)},d=function(){e.e("components/uni-number-box/uni-number-box").then(function(){return resolve(e("99a4"))}.bind(null,e)).catch(e.oe)},f={components:{uniGoodsNav:r,uniPopupDialog:l,uniPopup:a,uniNumberBox:d},onLoad:function(o){var t=this;console.log(o),this.itemId=o.id,this.getDetail(),this.$request.get("goods/related",{id:this.itemId}).then((function(o){t.relateList=o.data.list}))},onReady:function(){},data:function(){return{itemId:"",options:[{icon:"star",text:"收藏",info:0,infoBackgroundColor:"#007aff",infoColor:"red"},{icon:"cart",text:"购物车",info:0}],options_dialog:[],buttonGroup:[{text:"加入购物车",backgroundColor:"rgb(255, 20, 151)",color:"#fff"},{text:"立即购买",backgroundColor:"rgb(180, 40, 45)",color:"#fff"}],buttonGroup_dialog:[{text:"加入购物车",backgroundColor:"#ff8917",color:"#fff"},{text:"立即购买",backgroundColor:"#ff6034",color:"#fff"}],chooseT:-1,background:["color1","color2","color3"],indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,issue:[],goods:{userHasCollect:0,info:{gallery:[]}},sku:{tree:[],list:[],price:"1.00"},relateList:[],skuGoods:{title:"",picture:""},cartInfo:0,selectSku:{selectedNum:1,selectedSkuComb:{sku_str:"aa"}},propsPopup:!1,showSku:!1,chooseGoodsInfo:{name:"",price:"",stock_num:"",id:""},maxNum:1,inputNum:1}},methods:{onClick:function(t){"收藏"==t.content.text?this.addCollect():"购物车"==t.content.text&&(console.log("111"),o.switchTab({url:"/pages/cart/cart"}))},ifCollect:function(){var o=document.getElementsByClassName("uni-icons");console.log(o),1==this.goods.userHasCollect?o[1].style.color="#ff1497":o[1].style.color="rgb(100, 101, 102)"},onClickDialog:function(o){console.log(o)},openDialog:function(){this.$refs.popup.open()},buttonClick:function(o){console.log(o),0==o.index?(console.log("加入购物车"),this.$refs.popup.open()):(console.log("立即购买"),this.$refs.popup.open())},buttonClickDialog:function(o){console.log(o),0==o.index?(console.log("加入购物车"),this.addCart()):(console.log("立即购买"),this.buyGoods())},addCollect:function(){var t=this;this.$request.post("collect/addordelete",{valueId:this.itemId,type:0}).then((function(e){1===t.goods.userHasCollect?(t.goods.userHasCollect=0,t.ifCollect()):(t.goods.userHasCollect=1,o.showToast({title:"收藏成功",icon:"none"}),t.ifCollect())}))},close:function(){this.$refs.popup.close()},chooseTag:function(o,t){for(var e in console.log(o),this.chooseT=t,this.chooseGoodsInfo.name=o.name,this.chooseGoodsInfo.id=o.id,this.sku.list)if(this.sku.list[e].s1){if(this.sku.list[e].s1===o.id)return this.chooseGoodsInfo.price=(this.sku.list[e].price/100).toFixed(2),this.chooseGoodsInfo.stock_num=this.sku.list[e].stock_num,this.chooseGoodsInfo.s1=o.id,void(this.maxNum=this.chooseGoodsInfo.stock_num)}else if(this.sku.list[e].s2){if(this.sku.list[e].s2===o.id)return this.chooseGoodsInfo.price=(this.sku.list[e].price/100).toFixed(2),this.chooseGoodsInfo.stock_num=this.sku.list[e].stock_num,this.chooseGoodsInfo.s2=o.id,void(this.maxNum=this.chooseGoodsInfo.stock_num)}else if(this.sku.list[e].s3&&this.sku.list[e].s3===o.id)return this.chooseGoodsInfo.price=(this.sku.list[e].price/100).toFixed(2),this.chooseGoodsInfo.stock_num=this.sku.list[e].stock_num,this.chooseGoodsInfo.s3=o.id,void(this.maxNum=this.chooseGoodsInfo.stock_num)},changeNum:function(o){console.log(o),this.inputNum=o},getDetail:function(){var o=this;this.$request.get("goods/detail",{id:this.itemId}).then((function(t){o.goods=t.data,o.issue=t.data.issue;var e=o;setTimeout((function(){e.onEditorReady(),e.autoHeight(),e.ifCollect()}),1e3),o.skuAdapter()})),this.getCartInfo()},getCartInfo:function(){var o=this;this.$request.get("cart/goodscount",{}).then((function(t){o.cartInfo=t.data,o.options[1].info=t.data}))},onEditorReady:function(){var t=this;o.createSelectorQuery().select("#editor").context((function(o){t.editorCtx=o.context,t.editorCtx.setContents({html:t.goods.info.detail})})).exec()},autoHeight:function(){for(var o=document.getElementsByClassName("rightD"),t=0;t<o.length;t++)o[t].clientHeight<o[t].previousElementSibling.clientHeight&&(o[t].style.height=o[t].previousElementSibling.clientHeight-20+"px")},linkTo:function(t){console.log(t),o.navigateTo({url:"/pages/details/details?id="+t.id})},addCart:function(){var t=this,e=this.chooseGoodsInfo,i={goodsId:this.itemId,number:this.inputNum,productId:0};n.default.has(e,"s3")?o.showToast({title:"目前仅支持两规格",icon:"none"}):(n.default.has(e,"s2")?i.productId=this.getProductId(e.s1,e.s2):i.productId=this.getProductIdByOne(e.s1),console.log(i),i.productId?this.$request.post("cart/add",i).then((function(e){console.log(e),"请登录"!==e.errmsg?(t.cartInfo=Number(t.cartInfo)+Number(t.inputNum),t.options[1].info=t.cartInfo,o.showToast({title:"已添加至购物车",icon:"none",duration:1500}),t.$refs.popup.close()):o.showToast({title:"请登录",icon:"none",duration:1500})})):o.showToast({title:"库存不足",icon:"none",duration:1500}))},buyGoods:function(){var t=this,e=this.chooseGoodsInfo,i={goodsId:this.itemId,number:this.inputNum,productId:0};n.default.has(e,"s3")?o.showToast({title:"目前仅支持两规格",icon:"none"}):(n.default.has(e,"s2")?i.productId=this.getProductId(e.s1,e.s2):i.productId=this.getProductIdByOne(e.s1),i.productId?this.$request.post("cart/fastadd",i).then((function(e){if(console.log(e),"请登录"!==e.errmsg){var n=e.data.data;setLocalStorage({CartId:n}),t.$router.push("/order/checkout")}else o.showToast({title:"请登录",icon:"none",duration:1500})})):o.showToast({title:"库存不足",icon:"none",duration:1500}))},getProductId:function(o,t){var e,i,s;return n.default.each(this.goods.specificationList,(function(e){n.default.each(e.valueList,(function(e){e.id===o?i=e.value:e.id===t&&(s=e.value)}))})),n.default.each(this.goods.productList,(function(o){var t=n.default.without(o.specifications,i,s);0===t.length&&(e=o.id)})),e},getProductIdByOne:function(o){var t,e;return n.default.each(this.goods.specificationList,(function(t){n.default.each(t.valueList,(function(t){t.id!==o||(e=t.value)}))})),n.default.each(this.goods.productList,(function(o){var i=n.default.without(o.specifications,e);0===i.length&&(t=o.id)})),t},skuAdapter:function(){var o=this.setSkuTree(),t=this.setSkuList(),e={price:parseInt(this.goods.info.retailPrice),stock_num:0,collection_id:"",none_sku:!1,hide_stock:!0};this.sku=u({tree:o,list:t},e),this.skuGoods={title:this.goods.info.name,picture:this.goods.info.picUrl},this.chooseGoodsInfo.name=this.sku.tree[0].k,this.chooseGoodsInfo.price=this.sku.price,console.log(this.sku)},setSkuTree:function(){var o=[];return n.default.each(this.goods.specificationList,(function(t,e){var i=[];n.default.each(t.valueList,(function(o){o.name=o.value,i.push({id:o.id,name:o.value,imUrl:o.picUrl})})),o.push({k:t.name,v:i,k_s:"s"+(1+~~e)})})),o},setSkuList:function(){var o=this,t=[];return n.default.each(this.goods.productList,(function(e){var i={};n.default.each(e.specifications,(function(t,e){i["s"+(1+~~e)]=o.findSpecValueIdByName(t)})),i.price=100*e.price,i.stock_num=e.number,t.push(i)})),console.log(),t},findSpecValueIdByName:function(o){var t=0;return n.default.each(this.goods.specificationList,(function(e){n.default.each(e.valueList,(function(e){e.value!==o||(t=e.id)}))})),t}}};t.default=f}).call(this,e("543d")["default"])},f9b6:function(o,t,e){"use strict";e.r(t);var n=e("2f5e"),i=e("aecd");for(var s in i)"default"!==s&&function(o){e.d(t,o,(function(){return i[o]}))}(s);e("ef66");var u,c=e("f0c5"),r=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,"cd620de0",null,!1,n["a"],u);t["default"]=r.exports}},[["aa11","common/runtime","common/vendor"]]]);